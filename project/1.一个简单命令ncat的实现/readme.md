# 题目

我们已经见过了 **gcc**， **make**， **rm** 这些命令，它们功能强大，会根据参数的不同产生不同的执行效果。我们之前写的程序大多数程序没有实现这种特性。

在常见的操作系统中，我们日常使用的绝大部分应用程序其实都会对命令行参数进行识别，比如你现在浏览计蒜客所使用的软件（有可能是浏览器或者客户端等等），也是会识别命令行参数的，参数的不同可以让它产生不同的运行效果。

接下来，我们来实现一个简单的程序，它可以根据参数的不同执行有一定区别的功能。

## 完整目标

实现一个我们起名为 **ncat** 的命令，**其作用是把输入的内容每行前加上行号输出**。它可能有2个、3个或4个命令行参数。

第一个命令行参数是它本身的名字，在这里我们可以忽略；

第二个参数一定是 **-d** （表示decimal） 或者 **-r** （表示roman）中的一个，若为 **-d** 则行号用阿拉伯数字表示，若为 **-r** 则行号用罗马数字表示；

若存在第三个参数则其表示输入文件的路径，若不存在则表示输入来自标准输入；

若存在第四个参数则其表示输出文件的路径，若不存在则表示输出到标准输出。

注意：行号与输入文本的回显之间用 **\t** 隔开。

## 给出的结构

![img](D:\Maureen\m18623662873@163.com\d3c1f15886e94910b85b492c3420d204\clipboard.png)

- **Makefile** 可以运行**make** 进行自测

- **src** 编写和编译代码的目录，这里要求的所有任务都在这里完成。本节中，在终端里我们可以输入 **pushd src** 并按回车进入这个目录，之后可以输入 **popd** 并按回车退回进入之前的目录。

- - **Makefile** 用于编译 **ncat**，要求符合相关规范
  - **ncat.c** 这里需要自己实现 **ncat** 命令主函数
  - **roman.c** 提供函数 **char\* to_roman_numeral(char\* dst, int src)** 用于将数字 **src** 转换为罗马数字字符串存于 **dst** 所指向的空间中，并返回 **dst**的值。
  - **roman.h** 这是 **roman.c** 对应的头文件。

- **srctestbyscript** 运行自测的用的目录，不必修改其中内容。

- - **d** 输入样例所对应的行号为阿拉伯数字时的输出样例
  - **in** 输入样例
  - **r** 输入样例所对应的行号为罗马数字时的输出样例

- **usertest.sh** 与自测相关的文件，不必阅读和修改其中内容。

## 第一部分

在 **src/ncat.c** 中实现 **ncat** 命令的主函数，使之符合上述对 **ncat** 命令的要求，实现过程中允许使用和包含标准库函数及其头文件以及我们给出的 **to_roman_numeral** 函数和**roman.h** 头文件。

## 第二部分

编写 **src/Makefile** 要求在 **src** 目录下既可以通过 **make ncat** 编译和连接产生 **ncat** 命令，又可以通过**make clean**清除编译和连接生成的目标代码文件和其他文件，并且若一个文件被修改，不相干的文件不会被重新编译。

## 程序运行方式

先使用make命令编译ncat

```shell
make ncat
```

然后 

```
./ncat
```

后面跟参数 

```shell
-d/-r "[in_file]" "[out-file]
```



## 测试功能中遇到最多的问题

标准输入和输出的情况下：

```
测评用例 3 [所占分数 15] [未通过]
用例说明：./ncat 加`-d`，用 标准输入和标准输出
---------------------------
请注意单行字数极多、行数极多、连续空格或空行等情况！
```

该错误出现的情况是：按行读取文件内容 (“ncat1.c” 文件即是未通过标准输入和输出的文件)

```c
fgets(line, sizeof(line), in_fp)
```

然后单独处理了标准输入输出。

最后通过测试的程序是: 按字符读取文件内容。

```C
while ((ch = fgetc(fpin)) != EOF) {
		if (is_row_print) {
			if (is_roman) {
				fprintf(fpout, "%s\t", to_roman_numeral(roman_row, row));
			} else {
				fprintf(fpout, "%d\t", row);
			}
			is_row_print = 0;
		}
		if (ch == '\n') {
			++row;
			is_row_print = 1;
		}
		fprintf(fpout, "%c", ch);
}		
```

